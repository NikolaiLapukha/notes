## **Основные понятия**

**Эксплоит** (англ. exploit, эксплуатировать) — это подвид вредоносных программ, которые содержат код, способный проэксплуатировать, то есть воспользоваться, одной или несколькими уязвимостями в системе.

**Нагрузка** (англ. payload, Поле́зная нагру́зка) — код, который является частью эксплойта и выполняется после успешной эксплуатации системы.

**Фреймворк эксплуатации** — платформа для создания и отладки эксплойтов. Кроме того, включает в себя базу опкодов, архив шеллкодов и информацию по исследованиям информационной безопасности.

**Уязвимость нулевого дня** — термин, обозначающий неустранённые уязвимости, а также вредоносные программы, против которых ещё не разработаны защитные механизмы.

**Шеллкод** (англ. shellcode, код запуска оболочки) — это двоичный исполняемый код, который обычно передаёт управление командному процессору, например '/bin/sh' в Unix shell, 'command.com' в MS-DOS и 'cmd.exe' в операционных системах Microsoft Windows. Шелл-код может быть использован как полезная нагрузка эксплойта, обеспечивающая взломщику доступ к командной оболочке (англ. shell) в компьютерной системе.

**Опкод** (англ. opcode от operation code — код операции) — это специальный код, который представляет операцию или команду, выполняемую процессором компьютера. Он является непосредственной инструкцией для выполнения определенного действия, такого как сложение, умножение, сравнение и т.д.

## Наше положение в сети

На этом этапе мы **анализируем сетевые сервисы, отличные от веб-приложений.** Типовые проблемы сетевых сервисов:

- Проблемы конфигурации
- Слабые пароли
- Неиспользование шифрования
- Известные уязвимости

**Известные уязвимости** — уязвимости, которые присущи конкретному ПО и существуют в определенных версиях этого ПО.

![[Pasted image 20240603120007.png]]

## Общие принципы

**Рассмотрим все этапы базового примера по отдельности:**

- Обнаружение цели
- Исследование цели
- Поиск уязвимостей
- Подбор эксплойта
- Эксплуатация уязвимости
- 
**Этап 1.** Обнаружение

Для начала нужно понимать что он находится на каком-то из открытых портов сервера и вам важно научиться искать такие порты и сервисы.

Для понимания механизма сканирование открытых портов и сервисов на них, необходимо разобраться с работой сетевых протоколов отвечающих за работу с данными «абстрактными понятиями».

Уже сейчас вы научитесь пользоваться сканерами сети, и сможете достигать некоторых результатов, но для действительного обладания знанием и пониманием происходящего вам предстоит самостоятельно изучить протоколы, лежащие в основе сетевого взаимодействия сегодня: **TCP, UDP, IP, ICMP.**

**Этап 2.** Исследование сервиса

На этом этапе наши главные задачи:

- Выявить программное обеспечение и его точную версию
- Обнаружить особенности настройки сервиса (демо режим \ стандартные настройки \ используемые патчи)
- Изучить прочие детали состояния сервиса и возможные данные, имеющиеся у нас, связанные с ним.

Возможными проблемами на этом этапе может быть отсутствие явной информации о версии ПО, в таком случае могут помочь различные трюки:

- Подсчет контрольных сумм статичных файлов, для сравнения их с файлами определенной версии (favicon, js код, изображения)
- Исследование изменений в коде и изучение патчей, которые видны из кода веб страниц, сравнение их с версиями кода в репозиториях
- Поиск функций отладки или специальных страниц, раскрывающих информацию о ПО

**Этап 4.** Подбор эксплоита для конкретной уязвимости

> Важно понимать: далеко не всегда, узнав об уязвимости, мы будем получать эксплойт к ней.  
> Проблема в том, что для большинства уязвимостей эксплойты так и не становятся известны.

Доступны два сценария:

  1. Мы узнали о наличии уязвимости в ПО и его определенной версии, и для него есть эксплоит, который можно найти в сети.

В таком случае нам остается:

-     найти эксплоит,
-     разобраться в принципах его работы,
-     изучить код эксплойта, прежде чем запускать его,
-     донастроить\дописать эксплоит под свою задачу
-     отладить его на своем локальном стенде
-     применить эксплоит

    2. Мы узнали о наличии уязвимости в ПО и его определенной версии, и для него нет публичного эксплойта.

В таком случае вариантов не много:

-     узнать можно ли где-то приобрести данный эксплоит
-     исследовать ПО и его определенную версию с целью обнаружить уязвимость и подготовить эксплоит самостоятельно.

**Этап 5.** Эксплуатация уязвимости

Предполагается что до этапа эксплуатации у вас есть отлаженные, подготовленный эксплоит для вашей версии ПО и вы можете его применить.

Убедитесь что:

- вы знаете что будет делать эксплоит, как и почему это сработает;
- эксплоит не нарушит работоспособности системы и не изменит ее состояние существенно;
- эксплоит не содержит закладок и “логических бомб”, которые могут быть спрятаны туда злоумышленником;
- после выполнения эксплойта вам не придется применять его второй раз (подготовьтесь к закреплению доступа, убедитесь что вы решаете задачу за наименьшее число шагов)
## Эксплуатация уязвимости при помощи фреймворка

Обратим свое внимание на этап эксплуатации уязвимостей.

Зачастую для эксплуатации уязвимостей используются либо отдельные эксплойты, созданные специально под конкретную уязвимость. Либо используются фреймворки эксплуатации, которые разработаны для унификации подготовки, настройки и тестирования эксплойтов.

**Metasploit Framework**

Современная версия Metasploit содержит более 2000 эксплойтов, более 1000 модулей разведки и сканирования, модули пост эксплуатации, нагрузки, кодировщики, средства противодействия обнаружению и пр.

**Полезная нагрузка**

В настоящее время Metasploit имеет более 600 полезных нагрузок

**Вспомогательные модули**

Metasploit Framework включает сотни вспомогательных модулей, которые могут выполнять сканирование, fuzzing, sniffing и многое другое. Существует три типа вспомогательных модулей: сканеры, администраторы и серверные модули.

```bash
msfconsole <- Запуск фреймворка search struts showcase <- Поиск всех возможных эксплойтов с содержимым строки “struts showcase” use exploit/multi/http/struts2_code_exec_showcase <- Выбор эксплойта для работы последующей настройки info <- Изучение информации об эксплойте options <- Демонстрация опций для настройки эксплойта set RHOSTS localhost <- Настройка узла для применения эксплойта set RPORT 1337 <- Настройка порта для применения эксплойта set TARGETURI /integration/saveGangster.action <- Настройка места нахождения уязвимого плагина на сайте set PAYLOAD cmd/unix/generic <- Настройка “нагрузки” исполняемой после применения эксплойта set CMD 'cat /flag' <- Настройка опций нагрузки (Указание команды, которую необходимо выполнить) check <- Использование “чекера” для проверки корректности настроенного эксплойта exploit <- Эксплуатация уязвимости
```

## Уязвимости 0-го дня

> Обычно поиск уязвимостей 0-го дня производят энтузиасты, которые в дальнейшем сообщают о найденных уязвимостях производителям, чтобы те исправили проблемы безопасности.

Среди них можно выделить:

- Пентестеров
- Исследователей

** Что может помочь в поиске?**

- Анализ исходных кодов
- Динамический анализ
- Фаззинг тестирование

** Известные случаи утечек уязвимостей 0-го дня:**

**EternalBlue** — это компьютерный эксплойт, разработанный Агентством национальной безопасности США (АНБ). Утечка информации о нем была осуществлена хакерской группой **Shadow Brokers** 14 апреля 2017 года, через месяц после того, как **Microsoft** выпустила патчи для этой уязвимости.

